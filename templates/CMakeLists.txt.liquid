cmake_minimum_required(VERSION 3.1)
project({{system.name}})

set(CMAKE_CXX_STANDARD 14)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# this target is a dummy for subprojects to add their dependencies
if(BUILD_TESTING)
set(CMAKE_CTEST_COMMAND ctest -V)

if(NOT TARGET check)
add_custom_target(check COMMAND ${CMAKE_CTEST_COMMAND})
endif()

endif(BUILD_TESTING)

# checks are workaround until generator support feature check properly
IF( IS_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/apigear" )
find_package(apigear QUIET)
if(NOT apigear_FOUND)
  # pull apigear as dependency
  message(STATUS "apigear NOT FOUND, building from source folder")
  include(FetchContent)
  FetchContent_Declare(apigear
    SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/apigear"
  )
  FetchContent_MakeAvailable(apigear)
endif()
ENDIF()
{% for module in system.modules %}
find_package({{module.name|identifier}} QUIET)
if(NOT {{module.name|identifier}}_FOUND)
  # pull {{module.name|identifier}} as dependency
  message(STATUS "{{module.name|identifier}} NOT FOUND, building from source folder")
  include(FetchContent)
  FetchContent_Declare({{module.name|identifier}}
    SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/modules/{{module.name|identifier}}_module/{{module.name|identifier}}"
  )
  FetchContent_MakeAvailable({{module.name|identifier}})
endif()
{% endfor %}
IF( IS_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/examples" )
add_subdirectory(examples/app)
IF( IS_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/examples/olinkserver" )
add_subdirectory(examples/olinkserver)
add_subdirectory(examples/olinkclient)
ENDIF()
ENDIF()
