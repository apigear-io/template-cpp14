{% comment %} // Copyright (c) ApiGear UG 2020 {% endcomment -%}
{{ module | licGPLcpp }}
{% assign class = interface.name | capital -%}
{% assign sub_class = "I" | append: interface.name | capital | append: "Subscriber" %}
{% assign pub_class = interface.name | capital | append: "Publisher" %}
{% assign pub_interface = "I" | append: interface.name | capital | append: "Publisher"%}

#include "{{module.name|identifier}}/implementation/{{class|lower}}.h"
#include "{{module.name|identifier}}/generated/core/{{interface.name|lower}}.publisher.h"

using namespace {{ system.name | capital }}::{{ module.name | capital }};

struct {{class}}::{{class}}Data
{
{% for property in interface.properties %}
    {{property|cpp14Return}} m_{{property.name}};
{% endfor %}
};

{{class}}::{{class}}()
    : m_publisher(std::make_unique<{{pub_class}}>()),
      m_data(std::make_unique<{{class}}::{{interface.name | capital}}Data>())
{
}
{{class}}::~{{class}}()
{
}
{% for property in interface.properties %}

void {{class}}::set{{property.name|capitalize}}({{ property|cpp14Param }})
{
    if (m_data->m_{{property.name}} != {{property.name}}) {
        m_data->m_{{property.name}} = {{property.name}};
        m_publisher->publish{{property.name|capital}}Changed({{property.name}});
    }
}

{{property|cpp14Return: true}} {{class}}::{{property.name}}() const
{
    return m_data->m_{{property.name}};
}
{% endfor %}

{% for operation in interface.operations %}

{{operation|cpp14Return}} {{class}}::{{operation.name}}({{operation|cpp14Params}})
{
    {% for parameter in operation.params %}
    (void) {{parameter.name}}; //suppress the 'Unreferenced Formal Parameter' warning.
    {% endfor %}
    // do business logic here
    return {};
}

{% capture returnType %}{{operation|cpp14Return}}{% endcapture %}

std::future<{{returnType}}> {{class}}::{{operation.name}}Async({{operation|cpp14Params}})
{
    return std::async(std::launch::async, [this{%- for param in operation.params -%},
                    {{param}}
                {%- endfor -%}]()
        {
            return {{operation.name}}({%- for param in operation.params -%}
                    {{param}}{% unless forloop.last %},{% endunless %}
                {%- endfor -%});
        }
    );
}
{% endfor %}

{{pub_interface}}& {{class}}::_getPublisher() const
{
    return *m_publisher;
}
